import{_ as e}from"./index.2822d240.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import{r as a,w as l,o as n,H as s,k as t,e as o,d as i,J as d,S as r,U as m,a1 as u,a2 as c,f,W as p,ab as v,ac as g,ag as F,E as h}from"./vue.3a1c5826.js";import{H as b,F as k,n as D,I as w,x,B as _}from"./antd.e0f179d3.js";function y(e){let t,o;const i="customers",d=a({idbList:[]}),r=Array.from({length:10},((e,a)=>({sn:`${a}`,name:`name-${a}`,age:`${18+a}`,email:`name-${a}@email.com`}))),m=(e,a)=>o.transaction(e,a).objectStore(e[0]),u=()=>{const e=o.createObjectStore(i,{keyPath:"sn"});e.createIndex("name","name",{unique:!1}),e.createIndex("email","email",{unique:!0}),e.transaction.oncomplete=()=>{const e=m([i],"readwrite");r.forEach((a=>e.add(a)))}},c=()=>{m([i]).getAll().onsuccess=e=>{d.idbList=e.target.result}},f=e=>new Promise((a=>{const l=[];m([i]).index("name").openCursor().onsuccess=n=>{const s=n.target.result;s?(s.key.indexOf(e)>-1&&l.push(s.value),s.continue()):a(l)}})),p=e=>new Promise((a=>{m([i]).get(e).onsuccess=e=>{const l=e.target.result;a(l)}}));return l(e,(()=>{(()=>{const{sn:a,name:l}=e.value;""===a&&""===l?c():""!==a&&""===l?p(a).then((e=>{d.idbList=[e]})):""===a&&""!==l?f(l).then((e=>{d.idbList=e})):f(l).then((e=>{d.idbList=e.filter((e=>e.sn===a))}))})()}),{deep:!0}),n((()=>{window.indexedDB?(t=window.indexedDB.open("myIdb"),t.onerror=e=>{},t.onsuccess=e=>{o=e.target.result,c()},t.onupgradeneeded=e=>{o=e.target.result,u()}):b.error("您的浏览器不支持 IndexedDB")})),{addDB:async e=>{const{sn:a}=e;await p(a)?b.error("数据已存在"):m([i],"readwrite").add(e).onsuccess=()=>c()},putDB:(e,a)=>{const l=m([i],"readwrite");l.get(e).onsuccess=e=>{const n=e.target.result;Object.assign(n,a);l.put(n).onsuccess=()=>{b.success("操作成功"),c()}}},delDB:e=>{m([i],"readwrite").delete(e).onsuccess=()=>c()},getAllDB:c,...s(d)}}const R=k.useForm;const I=i({name:"IndexedDB",setup(){const e=t(!0),l=t(""),{formRef:n,formData:s,formParams:i,onFinishForm:r,onFinishFailedForm:m,resetForm:u}=function(){const e=t({}),l=a({sn:"",name:""}),n=t({pageNum:1,pageSize:10});return{formRef:e,formData:l,formParams:n,onFinishForm:e=>{n.value={...l,...e,pageNum:1}},onFinishFailedForm:e=>{},resetForm:()=>{e.value.resetFields()}}}(),{showModal:c,modelRef:f,modalValidateInfos:p,modalResetFields:v,modalValidate:g}=function(){const e=t(!1),l=a({sn:"",name:"",age:"",email:""}),n=a({sn:[{required:!0,message:"请输入 ssn 码"}],name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}],email:[{required:!0,message:"请输入邮箱"}]}),{resetFields:s,validate:o,validateInfos:i}=R(l,n,{onValidate:(...e)=>{}});return{showModal:e,modelRef:l,modalValidateInfos:i,modalResetFields:s,modalValidate:o}}(),{addDB:F,putDB:h,delDB:b,idbList:k}=y(i),{gridOptions:D}=function(e){const a=t([{type:"seq",width:50},{field:"sn",title:"sn码"},{field:"name",title:"姓名"},{field:"age",title:"年龄"},{field:"email",title:"邮箱"},{field:"handle",title:"操作",slots:{default:"handle"}}]);return{gridOptions:o((()=>({border:!0,columns:a.value,data:e.value})))}}(k);return{formRef:n,formData:s,formParams:i,onFinishForm:r,onFinishFailedForm:m,resetForm:u,gridOptions:D,showModal:c,modelRef:f,modalValidateInfos:p,clickAdd:()=>{c.value=!0,e.value=!0},clickAddOk:()=>{g().then((()=>{c.value=!1,e.value?F(d(f)):h(l.value,d(f))})).catch((e=>{}))},clickAddCancel:()=>{v()},clickEdit:a=>{e.value=!1,c.value=!0,l.value=a.sn,Object.assign(f,a)},clickDel:e=>{b(e.sn)},isAdd:e}}}),B={class:"form"},C=h("查询"),j=h("重置"),O=h("新增"),A={class:"table"},V=h(" 编辑 "),U=h(" 删除 ");const q=e(I,[["render",function(e,a,l,n,s,t){const o=w,i=x,d=_,h=k,b=r("vxe-grid"),y=D;return m(),u("div",null,[c("div",B,[f(h,{ref:"formRef",model:e.formData,layout:"inline",autocomplete:"off",onFinish:e.onFinishForm,onFinishFailed:e.onFinishFailedForm},{default:p((()=>[f(i,{label:"sn码",name:"sn"},{default:p((()=>[f(o,{value:e.formData.sn,"onUpdate:value":a[0]||(a[0]=a=>e.formData.sn=a)},null,8,["value"])])),_:1}),f(i,{label:"姓名",name:"name"},{default:p((()=>[f(o,{value:e.formData.name,"onUpdate:value":a[1]||(a[1]=a=>e.formData.name=a)},null,8,["value"])])),_:1}),f(i,null,{default:p((()=>[f(d,{type:"primary","html-type":"submit"},{default:p((()=>[C])),_:1}),f(d,{style:{"margin-left":"10px"},onClick:e.resetForm},{default:p((()=>[j])),_:1},8,["onClick"]),f(d,{style:{"margin-left":"10px"},onClick:e.clickAdd},{default:p((()=>[O])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","onFinish","onFinishFailed"])]),c("div",A,[f(b,v(g(e.gridOptions)),{handle:p((({row:a})=>[f(d,{type:"primary",onClick:l=>e.clickEdit(a)},{default:p((()=>[V])),_:2},1032,["onClick"]),f(d,{style:{"margin-left":"10px"},type:"primary",onClick:l=>e.clickDel(a)},{default:p((()=>[U])),_:2},1032,["onClick"])])),_:1},16)]),f(y,{visible:e.showModal,"onUpdate:visible":a[6]||(a[6]=a=>e.showModal=a),title:"Basic Modal",onOk:e.clickAddOk,onCancel:e.clickAddCancel},{default:p((()=>[f(h,{"label-col":{span:4},"wrapper-col":{span:14}},{default:p((()=>[f(i,F({label:"ssn码"},e.modalValidateInfos.sn),{default:p((()=>[f(o,{value:e.modelRef.sn,"onUpdate:value":a[2]||(a[2]=a=>e.modelRef.sn=a),disabled:!e.isAdd},null,8,["value","disabled"])])),_:1},16),f(i,F({label:"姓名"},e.modalValidateInfos.name),{default:p((()=>[f(o,{value:e.modelRef.name,"onUpdate:value":a[3]||(a[3]=a=>e.modelRef.name=a)},null,8,["value"])])),_:1},16),f(i,F({label:"年龄"},e.modalValidateInfos.age),{default:p((()=>[f(o,{value:e.modelRef.age,"onUpdate:value":a[4]||(a[4]=a=>e.modelRef.age=a)},null,8,["value"])])),_:1},16),f(i,F({label:"邮箱"},e.modalValidateInfos.email),{default:p((()=>[f(o,{value:e.modelRef.email,"onUpdate:value":a[5]||(a[5]=a=>e.modelRef.email=a)},null,8,["value"])])),_:1},16)])),_:1})])),_:1},8,["visible","onOk","onCancel"])])}],["__scopeId","data-v-068752d8"]]);export{q as default};
